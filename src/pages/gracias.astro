---
import { Image } from 'astro:assets';
import covaroLogo from '../assets/covaro.jpg';
---

<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gracias por Registrarte</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1054543913267868');
      fbq('track', 'PageView');
      fbq('track', 'CompleteRegistration');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none" 
           src="https://www.facebook.com/tr?id=1054543913267868&ev=CompleteRegistration&noscript=1"/>
    </noscript>
    <!-- End Meta Pixel Code -->

    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 2rem;
        background: #ffffff;
      }

      .logo {
        margin: 1rem auto;
        max-width: 200px;
      }

      h2 {
        color: #6a1b9a;
        font-weight: 700;
        font-size: 1.8rem;
        margin-top: 1.5rem;
      }

      h3 {
        font-size: 1.8rem;
        font-weight: 600;
        margin: 1rem 0;
      }

      .whatsapp-button {
        background-color: #1e9600;
        color: white;
        padding: 1rem 2rem;
        font-size: 1.2rem;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        transition: 0.3s;
        text-decoration: none;
        display: inline-block;
        margin-top: 1rem;
      }

      .whatsapp-button:hover {
        background-color: #158c00;
      }

      .timer {
        font-size: 1.5rem;
        margin: 1rem auto;
        display: flex;
        justify-content: center;
        gap: 1rem;
        color: #444;
      }

      .timer div {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .timer span {
        font-size: 2rem;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="timer">
      <div>
        <span id="seconds">05</span>
        <small>Segundos</small>
      </div>
    </div>

    <!-- Logo con Astro -->
    <Image src={covaroLogo} alt="Logo Covaro" height={70} class="logo" />

    <h2>¡IMPORTANTE! Únete al grupo ahora!</h2>
    <h3>Allí te mandaremos todos los detalles del zoom</h3>

    <!-- Botón de WhatsApp -->
    <button id="whatsappBtn" class="whatsapp-button" disabled>
      UNIRME AL GRUPO DE WHATSAPP AQUÍ (<span id="countdown">5</span>)
    </button>

    <script>
      // Configuración
      const whatsappLink = "https://chat.whatsapp.com/GCozvVkGq5qHAj3Z8QyWUp";
      let seconds = 5;
      const countdownElement = document.getElementById('countdown');
      const secondsElement = document.getElementById('seconds');
      const whatsappBtn = document.getElementById('whatsappBtn');

      // Actualizar contadores
      function updateCounters() {
        secondsElement.textContent = String(seconds).padStart(2, '0');
        countdownElement.textContent = seconds;
      }

      // Habilitar botón y redireccionar
      function enableButtonAndRedirect() {
        whatsappBtn.disabled = false;
        whatsappBtn.innerHTML = 'UNIRME AL GRUPO DE WHATSAPP AQUÍ';
        
        whatsappBtn.addEventListener('click', function() {
          // Disparar evento de Lead
          if(typeof fbq !== 'undefined') {
            fbq('track', 'Lead');
          }
          
          // Redirección a WhatsApp
          window.location.href = whatsappLink;
        });
      }

      // Contador regresivo
      const interval = setInterval(() => {
        seconds--;
        updateCounters();
        
        if (seconds <= 0) {
          clearInterval(interval);
          enableButtonAndRedirect();
        }
      }, 1000);

      // Inicializar contadores
      updateCounters();
      
      // Disparar CompleteRegistration al cargar la página
      if(typeof fbq !== 'undefined') {
        fbq('track', 'CompleteRegistration');
      }
    </script>
  </body>
</html>
